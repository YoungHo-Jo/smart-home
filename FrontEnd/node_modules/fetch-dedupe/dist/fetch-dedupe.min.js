!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.FetchDedupe={})}(this,function(e){"use strict";var l={};function y(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.url,n=e.method,r=e.responseType,o=void 0===r?"":r,u=e.body,i=void 0===u?"":u;return[void 0===t?"":t,(void 0===n?"":n).toUpperCase(),o,i].join("||")}function m(e){var t=e.requestKey,n=e.res,r=e.err;(l[t]||[]).forEach(function(e){n?e.resolve(n):e.reject(r)}),l[t]=null}e.getRequestKey=y,e.isRequestInFlight=function(e){return!!l[e]},e.clearRequestCache=function(){l={}},e.fetchDedupe=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=arguments[2],r=void 0,o=void 0;n?(r=n,o=t):t.responseType?(r=t,o={}):(r={},o=t);var u=r.responseType,i=void 0===u?"":u,d=r.dedupe,s=void 0===d||d,f=r.requestKey||y({url:e.url||e,method:o.method||e.method||"",body:o.body||e.body||""}),c=void 0;if(s){l[f]||(l[f]=[]);var v=l[f],a=!!v.length,p={};if(c=new Promise(function(e,t){p.resolve=e,p.reject=t}),v.push(p),a)return c}var h=fetch(e,o).then(function(t){var e=void 0;return e=i instanceof Function?i(t):i||(204===t.status?"text":"json"),t[e]().then(function(e){if(t.data=e,!s)return t;m({requestKey:f,res:t})},function(){if(t.data=null,!s)return t;m({requestKey:f,res:t})})},function(e){if(!s)return Promise.reject(e);m({requestKey:f,err:e})});return s?c:h},Object.defineProperty(e,"__esModule",{value:!0})});
